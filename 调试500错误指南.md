# 调试 500 错误指南

## 🔍 问题诊断

如果遇到 500 错误，请按以下步骤检查：

### 步骤 1：查看服务器日志

运行应用时，查看终端输出中的服务器日志：

```bash
cd dist/mac-arm64
./记账系统.app/Contents/MacOS/记账系统 2>&1 | tee app.log
```

查找以下信息：
- `❌ SQLite 初始化失败` - 数据库初始化错误
- `SQLite 查询错误` - SQL 查询错误
- `❌ 获取统计信息失败` - 具体错误信息

### 步骤 2：检查数据库状态

在浏览器中访问调试端点：

```
http://localhost:5001/api/debug/db-status
```

这会显示：
- 数据库路径
- 所有表名
- transactions 表的结构和数据数量

### 步骤 3：常见问题

#### 问题 1：表不存在

**症状**：`no such table: transactions`

**解决**：
1. 检查数据库文件是否存在
2. 重新初始化数据库
3. 查看 `init-sqlite.js` 是否正确执行

#### 问题 2：SQL 语法错误

**症状**：`SQLite 查询错误` 或语法相关错误

**解决**：
- 检查 SQL 查询是否正确转换为 SQLite 语法
- 查看 `database-sqlite.js` 中的转换逻辑

#### 问题 3：数据库文件权限问题

**症状**：`unable to open database file`

**解决**：
- 检查数据库文件路径是否正确
- 检查文件权限
- 确保目录存在

## 🔧 快速修复

### 方法 1：删除数据库文件重新初始化

```bash
# 找到数据库文件位置（通常在用户数据目录）
# Mac: ~/Library/Application Support/dish-accounting-system/accounting.db

# 删除数据库文件
rm ~/Library/Application\ Support/dish-accounting-system/accounting.db

# 重新启动应用，数据库会自动重新初始化
```

### 方法 2：手动初始化数据库

如果自动初始化失败，可以手动运行：

```bash
cd server/database
node init-sqlite.js
```

## 📝 已添加的调试功能

1. **详细错误日志**：所有错误都会输出到控制台
2. **数据库状态端点**：`/api/debug/db-status` 可以查看数据库状态
3. **查询日志**：所有 SQL 查询都会记录

## 🚀 下一步

1. 重新打包应用
2. 运行并查看日志
3. 访问 `/api/debug/db-status` 检查数据库状态
4. 根据具体错误信息进行修复

