# 数据库位置说明

## 📍 当前数据库位置

系统会根据运行环境自动选择数据库位置：

### 1. 浏览器测试模式（开发模式）

**数据库位置：**
```
项目目录/data/accounting.db
```

**完整路径示例：**
```
/Users/hair/Documents/菜品记账系统/data/accounting.db
```

### 2. Electron 客户端（打包后的应用）

**数据库位置：**
```
~/Library/Application Support/dish-accounting-system/accounting.db
```

**完整路径示例：**
```
/Users/hair/Library/Application Support/dish-accounting-system/accounting.db
```

## 🔍 为什么会有两个位置？

这是**设计上的区别**：

- **开发模式**：使用项目目录，方便开发和调试
- **生产模式**：使用系统用户数据目录，符合桌面应用的标准做法

## 💡 如何统一使用同一个数据库？

如果你希望浏览器测试和客户端使用同一个数据库，有以下几种方法：

### 方法 1：使用 USE_CLIENT_DB 环境变量（推荐）✨

启动开发服务器时使用客户端数据库位置：

```bash
npm run dev:client-db
```

或者只启动后端：

```bash
npm run server:client-db
```

这样开发模式和客户端就会使用同一个数据库文件了！

### 方法 2：手动复制数据库文件

**从开发模式复制到客户端：**
```bash
# 复制开发模式的数据库到客户端位置
cp ~/Documents/菜品记账系统/data/accounting.db \
   ~/Library/Application\ Support/dish-accounting-system/accounting.db
```

**从客户端复制到开发模式：**
```bash
# 复制客户端的数据库到开发模式位置
cp ~/Library/Application\ Support/dish-accounting-system/accounting.db \
   ~/Documents/菜品记账系统/data/accounting.db
```

### 方法 3：使用符号链接（高级）

创建一个符号链接，让两个位置指向同一个文件：

```bash
# 备份客户端数据库（如果存在）
mv ~/Library/Application\ Support/dish-accounting-system/accounting.db \
   ~/Library/Application\ Support/dish-accounting-system/accounting.db.bak

# 创建符号链接（指向开发模式的数据库）
ln -s ~/Documents/菜品记账系统/data/accounting.db \
      ~/Library/Application\ Support/dish-accounting-system/accounting.db
```

## 🔧 查看当前使用的数据库位置

### 在开发模式中查看

启动开发服务器后，查看终端输出：
```
✅ SQLite 数据库连接成功: /Users/hair/Documents/菜品记账系统/data/accounting.db
SQLite 数据库路径: /Users/hair/Documents/菜品记账系统/data/accounting.db
```

### 在客户端中查看

打开客户端后，查看控制台输出（如果开启了开发者工具）：
```
✅ SQLite 数据库连接成功: /Users/hair/Library/Application Support/dish-accounting-system/accounting.db
```

### 通过 API 查看

访问：http://localhost:5001/api/debug/db-status

会显示数据库路径和状态。

## 📋 数据库文件信息

- **文件名**: `accounting.db`
- **文件类型**: SQLite 3 数据库
- **大小**: 根据数据量变化（初始几 KB）
- **创建时间**: 首次运行应用时自动创建

## 💾 数据备份建议

### 定期备份

建议定期备份数据库文件：

```bash
# 备份开发模式数据库
cp ~/Documents/菜品记账系统/data/accounting.db \
   ~/Desktop/accounting_dev_backup_$(date +%Y%m%d).db

# 备份客户端数据库
cp ~/Library/Application\ Support/dish-accounting-system/accounting.db \
   ~/Desktop/accounting_client_backup_$(date +%Y%m%d).db
```

### 数据迁移

如果需要将数据从一个环境迁移到另一个环境：

1. **从开发模式迁移到客户端：**
   ```bash
   # 停止客户端（如果正在运行）
   # 复制数据库文件
   cp ~/Documents/菜品记账系统/data/accounting.db \
      ~/Library/Application\ Support/dish-accounting-system/accounting.db
   ```

2. **从客户端迁移到开发模式：**
   ```bash
   # 停止开发服务器（如果正在运行）
   # 复制数据库文件
   cp ~/Library/Application\ Support/dish-accounting-system/accounting.db \
      ~/Documents/菜品记账系统/data/accounting.db
   ```

## ⚠️ 注意事项

1. **数据同步**：两个环境的数据库是**独立的**，修改一个不会影响另一个
2. **同时运行**：不要同时运行开发模式和客户端，它们会使用不同的数据库
3. **数据安全**：备份数据库文件即可完整备份所有数据
4. **卸载应用**：卸载 Electron 客户端**不会**删除用户数据目录中的数据库文件

## 🎯 推荐做法

1. **开发阶段**：使用开发模式的数据库（项目目录）
2. **测试阶段**：可以复制开发模式的数据库到客户端位置进行测试
3. **生产使用**：使用客户端的数据库（用户数据目录）

这样可以保持开发和生产环境的分离，避免意外修改生产数据。

