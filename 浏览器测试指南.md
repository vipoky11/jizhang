# 浏览器测试指南

## 🚀 快速开始

### 方法一：同时启动前后端（推荐）

在项目根目录运行：

```bash
npm run dev
```

这个命令会：
- 自动清理端口 5000 和 3000
- 启动后端服务器（端口 5001）
- 启动前端开发服务器（端口 3000）

### 方法二：分别启动前后端

**终端 1 - 启动后端：**
```bash
npm run server
```

**终端 2 - 启动前端：**
```bash
npm run client
```

## 📍 访问地址

启动成功后，在浏览器中访问：

- **前端应用**: http://localhost:3000
- **后端 API**: http://localhost:5001/api
- **健康检查**: http://localhost:5001/api/health

## ✅ 验证服务是否正常运行

### 1. 检查后端服务

在浏览器中访问：http://localhost:5001/api/health

应该看到：
```json
{
  "status": "OK",
  "message": "服务器运行正常",
  "database": "SQLite"
}
```

### 2. 检查前端服务

在浏览器中访问：http://localhost:3000

应该看到记账系统的界面。

## 🔧 常见问题

### 问题 1：端口被占用

**错误信息：**
```
Port 5001 is already in use
Port 3000 is already in use
```

**解决方法：**

```bash
# 自动清理端口（推荐）
bash scripts/kill-ports.sh

# 或手动清理
lsof -ti:5001 | xargs kill -9
lsof -ti:3000 | xargs kill -9
```

### 问题 2：前端无法连接后端

**检查：**

1. **确认后端是否运行**
   - 访问 http://localhost:5001/api/health
   - 查看终端是否有错误信息

2. **检查浏览器控制台**
   - 按 F12 打开开发者工具
   - 查看 Console 标签页是否有错误
   - 查看 Network 标签页，检查 API 请求是否成功

3. **确认 API 地址**
   - 前端默认使用：`http://localhost:5001/api`
   - 如果后端端口不同，需要设置环境变量：
     ```bash
     # 在 client 目录创建 .env 文件
     cd client
     echo "REACT_APP_API_URL=http://localhost:5001/api" > .env
     ```

### 问题 3：数据库未初始化

**错误信息：**
```
no such table: transactions
```

**解决方法：**

```bash
# 初始化 SQLite 数据库
node server/database/init-sqlite.js
```

## 📝 开发模式说明

### 前端开发服务器（端口 3000）

- 使用 React 开发服务器
- 支持热重载（修改代码自动刷新）
- 自动打开浏览器（可选）

### 后端服务器（端口 5001）

- 使用 Express.js
- 支持 nodemon 自动重启（修改代码自动重启）
- SQLite 数据库位于：`项目目录/data/accounting.db`

## 🎯 测试步骤

1. **启动服务**
   ```bash
   npm run dev
   ```

2. **等待启动完成**
   - 后端：看到 "🚀 服务器运行在端口 5001"
   - 前端：看到 "Compiled successfully!"

3. **打开浏览器**
   - 访问 http://localhost:3000
   - 或等待浏览器自动打开

4. **测试功能**
   - 添加交易记录
   - 查看统计信息
   - 切换不同菜单（记账管理、财务分析、备忘录）

## 🔍 调试技巧

### 查看后端日志

后端服务器会在终端输出所有 API 请求日志。

### 查看前端日志

1. 打开浏览器开发者工具（F12）
2. 查看 Console 标签页
3. 查看 Network 标签页（查看 API 请求）

### 测试 API 端点

使用 curl 或 Postman 测试：

```bash
# 健康检查
curl http://localhost:5001/api/health

# 获取所有交易记录
curl http://localhost:5001/api/transactions

# 获取统计信息
curl "http://localhost:5001/api/transactions/stats?startDate=2025-01-01&endDate=2025-12-31"
```

## 📌 注意事项

1. **数据库位置**
   - 开发模式：`项目目录/data/accounting.db`
   - 生产模式（Electron）：`~/Library/Application Support/dish-accounting-system/accounting.db` (Mac)

2. **CORS 配置**
   - 后端已配置 CORS，允许来自 `localhost:3000` 的请求

3. **环境变量**
   - 后端端口：`PORT=5001`（可在 `.env` 文件中修改）
   - 前端 API 地址：`REACT_APP_API_URL`（可在 `client/.env` 文件中修改）

## 🎉 完成

现在你可以在浏览器中测试应用了！

访问 http://localhost:3000 开始使用记账系统。

